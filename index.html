<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scaffolding Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
  h2 { padding: 15px; margin: 0; color: white; }
  .section { padding: 20px; }
  .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
  .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .card h3 { margin: 0 0 10px 0; font-size: 1.1em; }
  .red { color: red; font-weight: bold; }
  .blue-bg { background: #007BFF; }
  .teal-bg { background: #20C997; }
  .orange-bg { background: #FD7E14; }
  .purple-bg { background: #6F42C1; }
  .green-bg { background: #28A745; }
</style>
</head>
<body>

<!-- Section Headers -->
<div id="sheet1-section">
  <h2 class="blue-bg">Measurements</h2>
  <div class="section cards" id="sheet1"></div>
</div>
<div id="sheet2-section">
  <h2 class="teal-bg">Attendance Log</h2>
  <div class="section cards" id="sheet2"></div>
</div>
<div id="sheet3-section">
  <h2 class="orange-bg">Productivity</h2>
  <div class="section cards" id="sheet3"></div>
</div>
<div id="sheet4-section">
  <h2 class="purple-bg">Supervisor Performance</h2>
  <div class="section cards" id="sheet4"></div>
</div>
<div id="sheet5-section">
  <h2 class="green-bg">Final Attendance</h2>
  <div class="section cards" id="sheet5"></div>
</div>

<script>
const CORS_PROXY = "https://cors.isomorphic-git.org/";
const SHEETS = [
  { id: "sheet1", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRmYg3zmYTdR76pDZirRk3Q-jGChOHtKwW5sRhi9NmaOWjCCvMeGi_CzmtbEVRrVt_u4mgTQmyrjYB/pub?gid=675931107&single=true&output=csv", type: "measurements" },
  { id: "sheet2", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRmYg3zmYTdR76pDZirRk3Q-jGChOHtKwW5sRhi9NmaOWjCCvMeGi_CzmtbEVRrVt_u4mgTQmyrjYB/pub?gid=1025965600&single=true&output=csv", type: "attendanceLog" },
  { id: "sheet3", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRmYg3zmYTdR76pDZirRk3Q-jGChOHtKwW5sRhi9NmaOWjCCvMeGi_CzmtbEVRrVt_u4mgTQmyrjYB/pub?gid=1615191290&single=true&output=csv", type: "productivity" },
  { id: "sheet4", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRmYg3zmYTdR76pDZirRk3Q-jGChOHtKwW5sRhi9NmaOWjCCvMeGi_CzmtbEVRrVt_u4mgTQmyrjYB/pub?gid=1486071949&single=true&output=csv", type: "supervisorPerf" },
  { id: "sheet5", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRmYg3zmYTdR76pDZirRk3Q-jGChOHtKwW5sRhi9NmaOWjCCvMeGi_CzmtbEVRrVt_u4mgTQmyrjYB/pub?gid=1554768658&single=true&output=csv", type: "finalAttendance" }
];

function fetchSheet(sheet) {
  Papa.parse(CORS_PROXY + sheet.url, {
    download: true,
    header: true,
    complete: function(results) {
      renderSheet(sheet.id, sheet.type, results.data);
    }
  });
}

function renderSheet(containerId, type, data) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  if (type === "measurements") {
    data.forEach(row => {
      container.innerHTML += `<div class="card"><h3>${row.Date || 'No Date'}</h3><p>Project: ${row.Project || ''}</p><p>Measurement: ${row.Measurement || ''}</p></div>`;
    });
  }

  if (type === "attendanceLog") {
    data.forEach(row => {
      container.innerHTML += `<div class="card">
        <h3>${row["WORKER NAME"] || ''}</h3>
        <p>Date: ${row.DATE || ''}</p>
        <p>Supervisor: ${row["SUPERVISOR NAME"] || ''}</p>
        <p>Total Hours: ${row["TOTAL MANHOURS"] || ''}</p>
        <p class="${row["OT HOURS"] > 0 ? 'red' : ''}">OT Hours: ${row["OT HOURS"] || 0}</p>
      </div>`;
    });
  }

  if (type === "productivity") {
    data.forEach(row => {
      container.innerHTML += `<div class="card">
        <h3>${row.Date || ''}</h3>
        <p>Productivity: ${row.Productivity || ''}</p>
        <p>Target: ${row.Target || ''}</p>
      </div>`;
    });
  }

  if (type === "supervisorPerf") {
    data.forEach(row => {
      container.innerHTML += `<div class="card">
        <h3>${row["SUPERVISOR NAME"] || ''}</h3>
        <p>Avg Hours: ${row["Avg Hours"] || ''}</p>
        <p>Avg OT: ${row["Avg OT"] || ''}</p>
      </div>`;
    });
  }

  if (type === "finalAttendance") {
    data.forEach(row => {
      let totalPresent = 0;
      let totalOT = 0;
      let totalHours = 0;
      Object.keys(row).forEach(col => {
        if (col !== "WORKER NAME" && col !== "Grand Total" && row[col]) {
          let hrs = parseFloat(row[col]);
          if (!isNaN(hrs)) {
            totalHours += hrs;
            if (hrs === 8) totalPresent++;
            if (hrs > 8) totalOT += (hrs - 8);
          }
        }
      });
      container.innerHTML += `<div class="card">
        <h3>${row["WORKER NAME"] || ''}</h3>
        <p>Present Days: ${totalPresent}</p>
        <p class="${totalOT > 0 ? 'red' : ''}">Total OT Hours: ${totalOT}</p>
        <p>Total Hours: ${totalHours}</p>
      </div>`;
    });
  }
}

function loadAllSheets() {
  SHEETS.forEach(s => fetchSheet(s));
}

loadAllSheets();
setInterval(loadAllSheets, 30000); // Refresh every 30 seconds
</script>
</body>
</html>
